<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Beer Ranking App</title>
    <link rel="stylesheet" href="css/style.css" />


    <!-- Firebase Initialization -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-init.js"></script>

    <!-- App Modules -->
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/sessions.js"></script>
    <script type="module" src="js/beers.js"></script>
    <script type="module" src="js/ratings.js"></script>
    <script type="module" src="js/charts.js"></script>
    <script type="module" src="js/ui.js"></script>
</head>
<body>
    <h1>Beer Ranking App üç∫</h1>

    <h2>Create / Select Session</h2>
    <input id="sessionName" placeholder="Session name (e.g., 2025-03-18)" />
    <button onclick="createSession()">Create Session</button>

    <select id="sessionSelect"></select>
    <button onclick="loadSession()">Load Session</button>

    <h2>Add Beer</h2>
    <input id="beerName" placeholder="Beer name" />
    <button onclick="addBeer()">Add Beer</button>

    <h2>Beers</h2>
    <ul id="beerList"></ul>

    <h2>Rate Beers</h2>
    <div id="ratingSection"></div>

    <h2>Ratings Chart</h2>
    <canvas id="ratingsChart" width="400" height="200"></canvas>

    <h2>Results</h2>
    <table>
        <thead><tr><th>Beer</th><th>Average Rating</th></tr></thead>
        <tbody id="resultsTable"></tbody>
    </table>

    <script type="module" src="firebase.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>
<script>
    const beers = []; // { name, ratings: [] }


    function addBeer() {
        const name = document.getElementById("beerName").value.trim();
        if (!name) return;
        beers.push({ name, ratings: [] });
        document.getElementById("beerName").value = "";
        renderBeers();
        renderRatings();
        updateResults();
    }


    function renderBeers() {
        document.getElementById("beerList").innerHTML = beers.map(b => `<li>${b.name}</li>`).join("");
    }


    function renderRatings() {
        const div = document.getElementById("ratingSection");
        div.innerHTML = beers.map((b, i) => `
<div class='beer-entry'>
<strong>${b.name}</strong><br>
<div class="stars" id="stars-${i}">
${[1, 2, 3, 4, 5].map(n => `<span onclick="rate(${i}, ${n})">‚òÖ</span>`).join("")}
</div>
</div>`).join("");
    }


    function rate(index, stars) {
        beers[index].ratings.push(stars);
        highlightStars(index, stars);
        updateResults();
    }


    function highlightStars(index, count) {
        const spans = document.querySelectorAll(`#stars-${index} span`);
        spans.forEach((s, i) => {
            s.classList.toggle("active", i < count);
        });
    }


    function updateResults() {
        const table = document.getElementById("resultsTable");
        table.innerHTML = beers.map(b => {
            const avg = b.ratings.length ? (b.ratings.reduce((a, c) => a + c, 0) / b.ratings.length).toFixed(2) : "‚Äî";
            return `<tr><td>${b.name}</td><td>${avg}</td></tr>`;
        }).join("");
    }


    function exportResults() {
        let csv = "Beer,Average Rating"
        beers.forEach(b => {
            const avg = b.ratings.length ? (b.ratings.reduce((a, c) => a + c, 0) / b.ratings.length).toFixed(2) : "";
            csv += `${b.name},${avg}
`;
        });


        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "beer_ratings.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>